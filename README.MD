# ðŸš€ Deploy OWASP Juice Shop on OpenStack using Terraform and Ansible

This project demonstrates an **end-to-end deployment pipeline** for running **OWASP Juice Shop** on **OpenStack** using:
By Ori
- **Terraform** â€“ provision OpenStack infrastructure  
- **Ansible** â€“ configure gateway, edges, registry, proxy, and app runtime  
- **Kolla-Ansible** â€“ deploy and manage OpenStack services  
- **HAProxy** â€“ load balancing traffic from gateway to edge nodes  

The architecture follows a **Gateway â†’ Edge** model with a **private Docker registry** and **APT proxy**.
---

## Repository Structure

```text
.
â”œâ”€â”€ README.md                  # This file: docs and usage
â”œâ”€â”€ ansible/
â”‚   â”œâ”€â”€ site.yml               # Main playbook entry (or include)
â”‚   â””â”€â”€ playbooks/
â”‚       â”œâ”€â”€ gateway.yml        # Gateway: registry, apt proxy, HAProxy
â”‚       â”œâ”€â”€ edges.yml          # Edge nodes: pull image, run Juice Shop
â”‚       â”œâ”€â”€ edges_2.yml        # (Advance) Alternate/extra edge orchestration
â”‚       â”œâ”€â”€ gateway_repo.yml   # (Advance) Private APT repository
â”‚       â””â”€â”€ templates/
â”‚           â””â”€â”€ haproxy.cfg.j2 # HAProxy template
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf                # Terraform configuration
â”‚   â”œâ”€â”€ outputs.tf             
â”‚   â”œâ”€â”€ provider.tf
â”‚   â”œâ”€â”€ variables.tf           # Modify variables
â”‚   â””â”€â”€ json/                  # Supporting JSON files
```
## Architecture Overview
```
Laptop / Browser
        |
        v
+--------------------+
| Gateway (Public)   |
| - HAProxy (LB)     |
| - Docker Registry  |
| - apt-cacher-ng    |
+--------------------+
        |
        v
+--------------------+
| Edge Nodes (Private)|
| - Docker           |
| - Juice Shop       |
+--------------------+
```
## How to run
### Terraform
```
cd terraform
terraform init	
terraform plan 
terraform apply -auto-approve
terraform destroy -auto-approve
#Optional, remove cache
rm -rf .terraform .terraform.lock.hcl
```

After run, terraform will generate inventory,ini for ansible to run task.

### ðŸ§ª Inventory Validation & Debugging
```bash
ansible-inventory -i /etc/kolla/ansible/inventory/tenantA-inventory --list
ansible -i /etc/kolla/ansible/inventory/tenantA-inventory -m ping all
```

### Monitoring
```
# 1. application logs
docker logs [id]
# 2. OS logs
# all
ls /var/log
sudo journalctl
#OCI-based applications
sudo journalctl -u docker
# 3. Network logs
# Kernel network events
dmesg
dmesg | grep -i net
dmesg -T | grep -Ei 'net|tcp|udp|eth'
# System journal (network services)
sudo journalctl
sudo journalctl | grep -Ei 'network|tcp|udp|eth|docker'
# 4. Mornitoting
sudo tcpdump -i any
sudo tcpdump -i any port 8080 -w juice.pcap
docker logs -f condescending_solomon > app.log
sudo journalctl -u docker > docker.log
```

### Note
```
#Notes for usage later: 
ssh -i ~/.ssh/id_ecdsa ubuntu@<floating-ip>
```

